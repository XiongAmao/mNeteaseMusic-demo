"use strict";var audiotest;$(function(){function t(t){$(".page .background").css("background-image","url("+t.coverBlurUrl+")"),$(".song-cover").find("img").attr("src",t.coverUrl),$(".js-song-name").text(t.title),$(".js-song-author").text(t.singer),$(".js-song-gap").text("-")}function n(t){var n=t.lyric.split("\n"),a=/^\[(.+)\](.+)$/;(n=n.map(function(t){var n=t.match(a);if(n)return{time:n[1],words:n[2]}})).map(function(t){t&&$("<p/>").attr("data-time",t.time).text(t.words).appendTo(f)}),o()}function a(t){d.src=t;var n=void 0;$(d).on("canplay",function(){d.play(),console.log("can play now"),c.addClass("playing"),l.removeClass("ready"),$(".js-icon-loading").remove(),n=e()}),$(".js-play").on("click",function(){console.log("click play"),d.play(),n=e(),c.addClass("playing")}),$(".js-pause").on("click",function(){console.log("click pause"),d.pause(),c.removeClass("playing"),clearInterval(n)}),$(d).on("ended",function(){console.log("ended"),c.removeClass("playing"),$(".lrc-scroll").css("transform",""),clearInterval(n)})}function e(){return setInterval(function(){for(var t=s(d),n=f.find("p[data-time]"),a=void 0,e=0;e<n.length;e++){var o=n.eq(e).attr("data-time"),r=n.eq(e+1).attr("data-time");if(0!==n.eq(e+1).length&&o<t&&r>t){a=n.eq(e);break}}if(a){a.addClass("active").prev().removeClass("active");var i=a.offset().top-f.offset().top;f.css("transform","translateY(-"+i+"px)")}},500)}function o(){var t=u.offset().top,n=u.height(),a=t+n,e=$(".links").offset().top;if(e<a+20)if(e-t>n/3*2)u.css("height",n/3*2+"px").attr("data-lines",2);else{if(!(e-t<n/3*2+10))return;u.css("height",n/3+"px").attr("data-lines",1)}}function s(t){var n=t.currentTime,a=~~(n/60),e=n-60*a;return r(a)+":"+r(e)}function r(t){return t>=10?t+"":"0"+t}var i=location.search.match(/\bid=([^&]*)/)?location.search.match(/\bid=([^&]*)/)[1]:"-1",c=$(".jukebox-container"),l=$(".disc-switch"),u=$(".song-lyrics"),f=$(".song-lyrics .lrc-scroll"),d=audiotest=document.createElement("audio");$.get("./json/song_list.json").then(function(e){e.forEach(function(e){e.id===i&&(t(e),n(e),a(e.url))})})});