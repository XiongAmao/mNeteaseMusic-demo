"use strict";$(function(){function t(t){$(".page .background").css("background-image","url("+t.coverBlurUrl+")"),$(".song-cover").find("img").attr("src",t.coverUrl),$(".js-song-name").text(t.title),$(".js-song-author").text(t.singer),$(".js-song-gap").text("-")}function n(t){var n=t.lyric.split("\n"),e=/^\[(.+)\](.+)$/;(n=n.map(function(t){var n=t.match(e);if(n)return{time:n[1],words:n[2]}})).map(function(t){t&&$("<p/>").attr("data-time",t.time).text(t.words).appendTo(g)})}function e(t){v.src=t,v.play(),$(v).on("canplay",function(){l||(v.play(),console.log("can play now"),d.addClass("playing"),m=o(),s()),m=o()}),$(".js-play").on("click",function(){console.log("click play"),v.play(),m=o(),d.addClass("playing"),s()}),$(".js-pause").on("click",function(){console.log("click pause"),v.pause(),d.removeClass("playing"),clearInterval(m),i()}),$(v).on("ended",function(){console.log("ended"),d.removeClass("playing"),$(".lrc-scroll").css("transform",""),clearInterval(m),c()})}function o(){return setInterval(function(){for(var t=a(v),n=g.find("p[data-time]"),e=void 0,o=0;o<n.length;o++){var r=n.eq(o).attr("data-time"),s=n.eq(o+1).attr("data-time");if(0!==n.eq(o+1).length&&r<t&&s>t){e=n.eq(o);break}}if(e){e.addClass("active").prev().removeClass("active");var i=e.offset().top-g.offset().top;g.css("transform","translateY(-"+i+"px)")}},500)}function a(t){var n=t.currentTime,e=~~(n/60),o=n-60*e;return r(e)+":"+r(o)}function r(t){return t>=10?t+"":"0"+t}function s(){y||(h=setInterval(function(){p.css("transform","rotateZ("+w+"deg)"),w+=.36},20),y=!0)}function i(){clearInterval(h),y=!1}function c(){clearInterval(h),y=!1,p.css("transform","")}/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i.test(navigator.userAgent)||(window.location.href="../qr-code.html");var l=/Quark|baidu|UCBrowser|OPR|MicroMessenger|MttCustomUA/.test(navigator.userAgent),u=location.search.match(/\bid=([^&]*)/)?location.search.match(/\bid=([^&]*)/)[1]:"-1",d=$(".jukebox-container"),f=($(".disc-switch"),$(".song-lyrics")),g=$(".song-lyrics .lrc-scroll"),p=$(".disc-turner"),v=document.createElement("audio"),m=void 0,h=void 0,y=!1,w=0;!function(){var t=f.offset().top,n=f.height(),e=t+n,o=$(".links").offset().top;if(o<e+20)if(o-t>n/3*2)f.css("height",n/3*2+"px").attr("data-lines",2);else{if(!(o-t<n/3*2+10))return;f.css("height",n/3+"px").attr("data-lines",1)}}(),$.get("./json/song_list.json").then(function(o){o.forEach(function(o){o.id===u&&(t(o),n(o),e(o.url))})})});