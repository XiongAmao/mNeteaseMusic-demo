"use strict";$(function(){function t(t){$(".page .background").css("background-image","url("+t.coverBlurUrl+")"),$(".song-cover").find("img").attr("src",t.coverUrl),$(".js-song-name").text(t.title),$(".js-song-author").text(t.singer),$(".js-song-gap").text("-")}function n(t){var n=t.lyric.split("\n"),e=/^\[(.+)\](.+)$/;(n=n.map(function(t){var n=t.match(e);if(n)return{time:n[1],words:n[2]}})).map(function(t){t&&$("<p/>").attr("data-time",t.time).text(t.words).appendTo(g)})}function e(t){v.src=t,v.play(),$(v).on("canplay",function(){l||(v.play(),console.log("can play now"),f.addClass("playing"),m=a(),s()),m=a()}),$(".js-play").on("click",function(){console.log("click play"),v.play(),m=a(),f.addClass("playing"),s()}),$(".js-pause").on("click",function(){console.log("click pause"),v.pause(),f.removeClass("playing"),clearInterval(m),c()}),$(v).on("ended",function(){console.log("ended"),f.removeClass("playing"),$(".lrc-scroll").css("transform",""),clearInterval(m),i()})}function a(){return setInterval(function(){for(var t=o(v),n=g.find("p[data-time]"),e=void 0,a=0;a<n.length;a++){var r=n.eq(a).attr("data-time"),s=n.eq(a+1).attr("data-time");if(0!==n.eq(a+1).length&&r<t&&s>t){e=n.eq(a);break}}if(e){e.addClass("active").prev().removeClass("active");var c=e.offset().top-g.offset().top;g.css("transform","translateY(-"+c+"px)")}},500)}function o(t){var n=t.currentTime,e=~~(n/60),a=n-60*e;return r(e)+":"+r(a)}function r(t){return t>=10?t+"":"0"+t}function s(){y||(h=setInterval(function(){p.css("transform","rotateZ("+k+"deg)"),k+=.36},20),y=!0)}function c(){clearInterval(h),y=!1}function i(){clearInterval(h),y=!1,p.css("transform","")}var l=/Quark|baidu|UCBrowser|OPR|MicroMessenger|MttCustomUA/.test(navigator.userAgent),u=location.search.match(/\bid=([^&]*)/)?location.search.match(/\bid=([^&]*)/)[1]:"-1",f=$(".jukebox-container"),d=($(".disc-switch"),$(".song-lyrics")),g=$(".song-lyrics .lrc-scroll"),p=$(".disc-turner"),v=document.createElement("audio"),m=void 0,h=void 0,y=!1,k=0;!function(){var t=d.offset().top,n=d.height(),e=t+n,a=$(".links").offset().top;if(a<e+20)if(a-t>n/3*2)d.css("height",n/3*2+"px").attr("data-lines",2);else{if(!(a-t<n/3*2+10))return;d.css("height",n/3+"px").attr("data-lines",1)}}(),$.get("./json/song_list.json").then(function(a){a.forEach(function(a){a.id===u&&(t(a),n(a),e(a.url))})})});