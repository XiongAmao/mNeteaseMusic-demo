"use strict";$(function(){function s(s){t();var n=i(s);if(0==n.length){h.find("ol.song-list").empty().append('<div class="no-result">暂无搜索结果</div>')}else n.forEach(function(s){r(h.find("ol.song-list"),s,!1)})}function i(s){var i=[];if(s){var n=new RegExp(s);i=m.filter(function(s){return n.test(s.name)||n.test(s.album)||n.test(s.title)})}return i}function n(){f.removeClass("active"),g.addClass("active"),h.removeClass("active")}function e(){f.addClass("active"),g.removeClass("active"),h.removeClass("active")}function t(){f.removeClass("active"),g.removeClass("active"),h.addClass("active")}function a(s){var i=localStorage.getItem("search-history"),n=i?JSON.parse(i):[];-1===n.indexOf(s)&&n.push(s),localStorage.setItem("search-history",JSON.stringify(n))}function o(s){var i=localStorage.getItem("search-history"),n=i?JSON.parse(i):[];n=n.filter(function(i){return s!==i}),localStorage.setItem("search-history",JSON.stringify(n))}function l(){var s=$(".sd-history .search-list");s.empty(),JSON.parse(localStorage.getItem("search-history")).forEach(function(i){var n='  <li class="item"> <figure> <svg class="icon"> <use xlink:href="#icon-clock"></use> </svg> </figure> <p>'+i+'</p> <figure class="history-close"> <svg class="icon"> <use xlink:href="#icon-cha1"></use> </svg> </figure> </li>';s.append($(n))})}function c(){$.get("./json/hot_list.json").then(function(s){var i=$(".hot-list>ol.song-list");s.forEach(function(s){r(i,s,!0)}),i.find(".loading-spin").remove()})}function r(s,i,n){var e=[i.id,i.title,i.subTitle,i.singer,i.album,i.sq],t=e[0],a=e[1],o=e[2],l=e[3],c=e[4],r=e[5],v=void 0;if(n){var d=t>9?t:"0"+t;v='\n               <li class="song-item">\n                   <div class="song-rank '+(t>3?"":"top")+'">'+d+'</div>\n                   <a href="./song.html?id='+t+'">\n                       <div class="song-infos">\n                           <div class="sg-title">'+a+"<span>"+o+'</span></div>\n                           <div class="sg-singer">\n                               <svg class="icon sq '+r+'" aria-hidden="true">\n                                   <use xlink:href="#icon-sq"></use>\n                               </svg>\n                               <div class="singer-info">\n                                   '+l+" - "+c+'\n                               </div>\n                           </div>\n                       </div>\n                       <div class="song-icon-play">\n                           <svg class="icon play" aria-hidden="true">\n                               <use xlink:href="#icon-circle-play"></use>\n                           </svg>\n                       </div>\n                   </a>\n               </li>\n            '}else v='\n                <li class="song-item">\n                    <a href="./song.html?id='+t+'">\n                        <div class="song-infos">\n                            <div class="sg-title">'+a+"<span>"+o+'</span></div>\n                            <div class="sg-singer">\n                                <svg class="icon sq '+r+'" aria-hidden="true">\n                                    <use xlink:href="#icon-sq"></use>\n                                </svg>\n                                <div class="singer-info">\n                                   '+l+" - "+c+'\n                               </div>\n                            </div>\n                        </div>\n                        <div class="song-icon-play">\n                            <svg class="icon play" aria-hidden="true">\n                                <use xlink:href="#icon-circle-play"></use>\n                            </svg>\n                        </div>\n                    </a>\n                </li>\n            ';s.append(v)}var v=$(".search-form"),d=$(".search-form input"),u=$(".search-form .input-close"),f=$(".search-default"),g=$(".search-recom"),h=$(".search-result"),m=void 0,p=void 0;$(".site-nav>ol").on("click","li",function(s){this==document.querySelectorAll(".site-nav>ol>li")[1]&&c();var i=$(this).addClass("selected").siblings().removeClass("selected").end().index();$("article>section").eq(i).addClass("active").siblings().removeClass("active")}),$.get("./json/lastest_music.json").then(function(s){var i=$(".lastest-music>ol.song-list");s.forEach(function(s){r(i,s,!1)}),i.siblings(".loading-spin").remove()}),$.get("./json/song_list.json").then(function(s){m=s}),v.on("submit",function(i){var n=d.val();i.preventDefault(),s(n),a(n)}),u.on("click",function(s){d.val(""),u.removeClass("active"),h.find("ol.song-list").empty(),e(),clearTimeout(p),l()}),g.find(".sr-input-btn").on("click",function(){var i=d.val();s(i),a(i),l()}),d.on("input change",function(s){var t=$(this).val();t?(u.addClass("active"),g.addClass("active").find(".sr-input-btn").text("搜索 “"+t+"”"),n(),clearTimeout(p),p=setTimeout(function(){i(t)},600)):(h.find("ol.song-list").empty(),clearTimeout(p),e())}),$(".sd-hotlist").on("click","li",function(){var i=$(this).text();d.val(i),u.addClass("active"),s(i),a(i)}),$(".sd-history .search-list").on("click",".item",function(){console.log("click");var i=$(this).find("p").text();s(i),d.val(i),u.addClass("active")}).on("click",".history-close",function(s){o($(this).siblings("p").text()),l(),s.stopPropagation()}),l()});