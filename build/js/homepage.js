"use strict";$(function(){function s(s){a();var n=i(s);if(0==n.length){m.find("ol.song-list").empty().append('<div class="no-result">暂无搜索结果</div>')}else n.forEach(function(s){v(m.find("ol.song-list"),s,!1)})}function n(){m.find("ol.song-list").empty()}function i(s){var n=[];if(s){var i=new RegExp(s);n=p.filter(function(s){return i.test(s.name)||i.test(s.album)||i.test(s.title)})}return n}function e(){g.removeClass("active"),h.addClass("active"),m.removeClass("active")}function t(){g.addClass("active"),h.removeClass("active"),m.removeClass("active")}function a(){g.removeClass("active"),h.removeClass("active"),m.addClass("active")}function o(s){var n=localStorage.getItem("search-history"),i=n?JSON.parse(n):[];-1===i.indexOf(s)&&i.push(s),localStorage.setItem("search-history",JSON.stringify(i))}function c(s){var n=localStorage.getItem("search-history"),i=n?JSON.parse(n):[];i=i.filter(function(n){return s!==n}),localStorage.setItem("search-history",JSON.stringify(i))}function l(){new Promise(function(s,n){var i=$(".sd-history .search-list");i.empty(),JSON.parse(localStorage.getItem("search-history")).forEach(function(s){var n='  <li class="item"> <figure> <svg class="icon"> <use xlink:href="#icon-clock"></use> </svg> </figure> <p>'+s+'</p> <figure class="history-close"> <svg class="icon"> <use xlink:href="#icon-cha1"></use> </svg> </figure> </li>';i.append($(n))}),s()}).then($(".sd-history .search-list").find("li").each(function(n,i){$(i).on("click",function(n){var i=$(this).find("p").text();s(i),u.val(i),f.addClass("active")}).find(".history-close").on("click",function(s){c($(i).find("p").text()),l()})}))}function r(){$.get("./json/hot_list.json").then(function(s){var n=$(".hot-list>ol.song-list");s.forEach(function(s){v(n,s,!0)}),n.find(".loading-spin").remove()})}function v(s,n,i){var e=[n.id,n.title,n.subTitle,n.singer,n.album,n.sq],t=e[0],a=e[1],o=e[2],c=e[3],l=e[4],r=e[5],v=void 0;if(i){var d=t>9?t:"0"+t;v='\n               <li class="song-item">\n                   <div class="song-rank '+(t>3?"":"top")+'">'+d+'</div>\n                   <a href="./song.html?id='+t+'">\n                       <div class="song-infos">\n                           <div class="sg-title">'+a+"<span>"+o+'</span></div>\n                           <div class="sg-singer">\n                               <svg class="icon sq '+r+'" aria-hidden="true">\n                                   <use xlink:href="#icon-sq"></use>\n                               </svg>\n                               <div class="singer-info">\n                                   '+c+" - "+l+'\n                               </div>\n                           </div>\n                       </div>\n                       <div class="song-icon-play">\n                           <svg class="icon play" aria-hidden="true">\n                               <use xlink:href="#icon-circle-play"></use>\n                           </svg>\n                       </div>\n                   </a>\n               </li>\n            '}else v='\n                <li class="song-item">\n                    <a href="./song.html?id='+t+'">\n                        <div class="song-infos">\n                            <div class="sg-title">'+a+"<span>"+o+'</span></div>\n                            <div class="sg-singer">\n                                <svg class="icon sq '+r+'" aria-hidden="true">\n                                    <use xlink:href="#icon-sq"></use>\n                                </svg>\n                                <div class="singer-info">\n                                   '+c+" - "+l+'\n                               </div>\n                            </div>\n                        </div>\n                        <div class="song-icon-play">\n                            <svg class="icon play" aria-hidden="true">\n                                <use xlink:href="#icon-circle-play"></use>\n                            </svg>\n                        </div>\n                    </a>\n                </li>\n            ';s.append(v)}var d=$(".search-form"),u=$(".search-form input"),f=$(".search-form .input-close"),g=$(".search-default"),h=$(".search-recom"),m=$(".search-result"),p=void 0,y=void 0;$(".site-nav>ol").on("click","li",function(s){this==document.querySelectorAll(".site-nav>ol>li")[1]&&r();var n=$(this).addClass("selected").siblings().removeClass("selected").end().index();$("article>section").eq(n).addClass("active").siblings().removeClass("active")}),$.get("./json/lastest_music.json").then(function(s){var n=$(".lastest-music>ol.song-list");s.forEach(function(s){v(n,s,!1)}),n.siblings(".loading-spin").remove()}),$.get("./json/song_list.json").then(function(s){p=s}),d.on("submit",function(n){var i=u.val();n.preventDefault(),s(i),o(i)}),f.on("click",function(s){u.val(""),f.removeClass("active"),t(),l(),clearTimeout(y),n()}),h.find(".sr-input-btn").on("click",function(){var n=u.val();s(n),o(n),l()}),u.on("input change",function(s){var a=$(this).val();a?(f.addClass("active"),h.addClass("active").find(".sr-input-btn").text("搜索 “"+a+"”"),e(),clearTimeout(y),y=setTimeout(function(){i(a)},600)):(t(),clearTimeout(y),n())}),$(".sd-hotlist li").each(function(){var n=$(this).text();$(this).on("click",function(){u.val(n),f.addClass("active"),s(n),o(n)})}),l()});